<script context="module">
  import { state, sitelang, snapto, gateway, variables } from '$lib/stores'
  import Components from '$lib/Components.svelte'
  import SubPage from '$lib/SubPage.svelte'
  import { getSanityImageUrl/*, formatBlogPostDate*/ } from '$lib/sanity/helpers.js'
  //import { onMount } from 'svelte';
  //import * as scroller from "svelte-scrollto"
  //import { amp, browser, dev, prerendering } from '$app/env'
  const _site = variables.site
  const _siteurl = variables.siteurl[_site] || 'https://www.urosystem.com'
</script>
<script>
  //console.log({$state})
  let post, subs
  $: {
    post = $state.post.subpage || $state.post
    //subs = /*$state.post.subpage?.subpages || */$state.post.subpages
    //console.log('ID',$state.post.id,$state.post.subpage?.id)
    //console.log('POST',post.id)
    //console.log(post.sections)
  }
  //$: console.log({post})
</script>

<main>
  <!--{#if $state && !!$state.id}-->
  {#if !!post.hero}
    
    <!--<header id="header" class="full" style="{post.hero.background ? post.hero.background : ``}" on:click={() => $snapto = '#content'} on:keypress={() => $snapto = '#content'} tabindex="0" role="link">-->
    <!--<header id="header" class="-full" style="background-image: url({post.hero.image?.src})" on:click={() => $snapto = '#content'} on:keypress={() => $snapto = '#content'} tabindex="0" role="link">-->
    <header id="header" class="-full" style="{post.hero.image ? `background-image: url(${post.hero.image.src})` : ``}" on:click={() => $snapto = '#content'} on:keypress={() => $snapto = '#content'} tabindex="0" role="link">

      {#if post.herotitle && post.herotitle != ''}
        <h1>{post.herotitle}</h1>
        {#if post.hero.subtitle}
          <h2>{post.hero.subtitle}</h2>
        {/if}
      {:else if post.hero.title}<!-- && $state.post.title != '' -->
        <h1>{post.hero.title}</h1>
        {#if post.hero.subtitle}
          <h2>{post.hero.subtitle}</h2>
        {/if}
      {/if}

      {#if post.hero.ctas}
        {@const comp = {_type: 'ctaBlock', ctas: post.hero.ctas, slide: true}}
        <Components {comp}/>
      {/if}

      {#if post.subhero}
        {#each post.subhero.components || [] as comp}
          <Components {comp}/>
        {/each}
      {/if}

      <!--{#if subs && !post.hidesubs}-->
      {#if $state.post.subpages && !$state.post.hidesubs}
        <nav>
          <ul>
            <!--{#each subs as sub}-->
            {#each $state.post.subpages as sub}
              <li class:active={post.id == sub.id}><SubPage {sub} scrollto="#content"/></li>
            {/each}
          </ul>
        </nav>
      {/if}

    </header>
  {:else}
    <header id="header" on:click={() => $snapto = '#content'} on:keypress={() => $snapto = '#content'} tabindex="0" role="link">
      
      {#if $state.post.title != ''}
        <h1>{$state.post.title}</h1>
        {#if $state.post.subtitle}
          <h2>{$state.post.subtitle}</h2>
        {/if}
      {/if}
<!--
      {#if post.subhero}
        {#each post.subhero.components || [] as comp}
          <Components {comp}/>
        {/each}
      {/if}
-->
<!--
      {#if $state.post.subpages && !$state.post.hidesubs}
        <nav>
          <ul>
            {#each $state.post.subpages as sub}
              <li class:active={post.id == sub.id}><SubPage {sub} scrollto="#content"/></li>
            {/each}
          </ul>
        </nav>
      {/if}
-->
    </header>
  {/if}

  <div id="content"></div>

  <!--{#if !!post.hero}
    <h2>{post.title}</h2>
  {/if}-->

  {#if $state.post.subpage && $state.post.subpage.subpages && !$state.post.subpage.hidesubs}
    <nav>
      <ul>
        {#each $state.post.subpage.subpages as sub}
        <li class:active={post.id == sub.id}><SubPage {sub} scrollto="#content"/></li>
        {/each}
      </ul>
    </nav>
  {/if}

  {#each post.sections || [] as comp}
    <!--<div style="{comp.background}">-->
      <Components {comp}/>
    <!--</div>-->
  {/each}

  <!--{#if $state.post.subpage}
    <div style="{$state.post.background}">
      <h2>{post.title}</h2>
      {#each $state.post.blocks || [] as block}
        {#if block.published == undefined || (block.published === true || !!$gateway[block.published])}
          <div style="{block.background}">
            {#each block.components || [] as comp}
              <Components {comp}/>
            {/each}
          </div>
        {/if}
      {/each}
    </div>
  {/if}-->

  {#if $state.post.subpages && !$state.post.hidesubs}
    <nav>
      <h2>{$state.post.title}</h2>
      <ul>
        {#each $state.post.subpages as sub}
          <li class:active={post.id == sub.id}><SubPage {sub} scrollto="#content"/></li>
        {/each}
      </ul>
    </nav>
  {/if}
<!--{/if}-->
</main>
<!--{#if $sitelang == 'en' && $state.thislang.id == 'en'}-->
<a hidden aria-hidden="true" rel="redirect" href="/{!!$state.post.subpage && $state.post.slug !== '.' ? $state.post.path : ($state.post.path || '')}">&nbsp;</a>
<!--{/if}-->

<style>
  header {
    padding-top: 12rem;
    padding-bottom: 1rem;
  }
  header.full {
    padding-block: 3rem;
    height: auto;
    min-height: calc(100vh - var(--rem));
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
/*  main {
    padding-bottom: var(--gap);
  }*/
  h1/*, .h1*/ {
    cursor: pointer;
    margin-inline: auto;
  }
  nav {
    padding-block: 3rem;
  }
</style>